<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="robot_complet">
  
  <!-- Include du SRDF du bras FR3 standard -->
  <xacro:include filename="$(find franka_description)/robots/common/franka_arm.srdf.xacro"/>
  
  <!-- Arguments (garde les mêmes pour compatibilité) -->
  <xacro:arg name="robot_type" default="fr3" />
  <xacro:arg name="arm_prefix" default="" />
  <xacro:arg name="no_prefix" default="false"/>
  <xacro:arg name="hand" default="false" />  <!-- notre propre outil à la place -->
  <xacro:arg name="ee_id" default="none" />  <!-- pas de gripper Franka -->
  
  <!-- Inclusion du SRDF du bras FR3 (sans modif) -->
  <xacro:franka_arm_srdf 
    robot_type="$(arg robot_type)"
    hand="$(arg hand)"
    ee_id="$(arg ee_id)"
    no_prefix="$(arg no_prefix)"
    arm_prefix="$(arg arm_prefix)">
  </xacro:franka_arm_srdf>
  
  <!-- ========================================= -->
  <!-- AJOUTS POUR TON ROBOT CUSTOM             -->
  <!-- ========================================= -->
  
  <!-- 1. Groupe de planification : Bras + Rail -->
  <group name="fr3_sur_rail">
    <joint name="rail_joint"/>
    <joint name="fr3_joint1"/>
    <joint name="fr3_joint2"/>
    <joint name="fr3_joint3"/>
    <joint name="fr3_joint4"/>
    <joint name="fr3_joint5"/>
    <joint name="fr3_joint6"/>
    <joint name="fr3_joint7"/>
  </group>
  
  <!-- 2. End-effector : Ta sonde -->
  <end_effector name="sonde" parent_link="fr3_link8" group="sonde_group"/>
  
  
  <!-- 4. Collisions autorisées (sonde avec les links du bras) -->
  <!-- La sonde est attachée à link8, donc elle peut "toucher" link8 -->
  <disable_collisions link1="fr3_link8" link2="base-sonde" reason="Adjacent"/>
  <disable_collisions link1="fr3_link8" link2="sonde_tcp" reason="Adjacent"/>
  
  <!-- 5. Poses nommées pour le groupe avec rail -->
  <group_state name="ready" group="fr3_arm_with_rail">
    <joint name="rail_joint" value="0.5"/>     <!-- milieu du rail -->
    <joint name="fr3_joint1" value="0"/>
    <joint name="fr3_joint2" value="-0.785"/>   <!-- -45° -->
    <joint name="fr3_joint3" value="0"/>
    <joint name="fr3_joint4" value="-2.356"/>   <!-- -135° -->
    <joint name="fr3_joint5" value="0"/>
    <joint name="fr3_joint6" value="1.571"/>    <!-- 90° -->
    <joint name="fr3_joint7" value="0.785"/>    <!-- 45° -->
  </group_state>
  
  <group_state name="home" group="fr3_arm_with_rail">
    <joint name="rail_joint" value="0.0"/>      <!-- début du rail -->
    <joint name="fr3_joint1" value="0"/>
    <joint name="fr3_joint2" value="0"/>
    <joint name="fr3_joint3" value="0"/>
    <joint name="fr3_joint4" value="-1.571"/>   <!-- -90° -->
    <joint name="fr3_joint5" value="0"/>
    <joint name="fr3_joint6" value="1.571"/>    <!-- 90° -->
    <joint name="fr3_joint7" value="0"/>
  </group_state>
  
  <!-- 6. Virtual joint (si tu as une table comme base fixe) -->
  <virtual_joint name="virtual_joint" type="fixed" parent_frame="world" child_link="table"/>
  
</robot>